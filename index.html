<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Derivadas paso a paso</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.0.0/math.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.0.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script>
</head>
<body>
  <h1>Derivadora Interactiva</h1>
  <div>
    <label for="expr">Función f(x): </label>
    <input type="text" id="expr" value="sin(x) * x^2">
    <button onclick="compute()">Calcular</button>
  </div>
  <div id="steps"></div>
  <div id="equations"></div>
  <div id="plot" style="width:600px;height:400px;"></div>

<script>
// Computa derivada y gráfica
function compute() {
  const expr = document.getElementById('expr').value;
  const deriv = math.derivative(expr, 'x');
  const derivStr = deriv.toString();

  // Mostrar fórmulas con KaTeX
  document.getElementById('equations').innerHTML =
    katex.renderToString(`f(x) = ${math.parse(expr).toTex()}`, {throwOnError:false})
    + '<br>' +
    katex.renderToString(`f'(x) = ${math.parse(derivStr).toTex()}`, {throwOnError:false});

  // Mostrar pasos simples (reglas aplicadas)
  document.getElementById('steps').innerHTML = `<p>Derivación de <strong>${expr}</strong> respecto a x: <code>${derivStr}</code></p>`;

  // Generar datos para graficar
  const f = math.compile(expr);
  const fd = math.compile(derivStr);
  const xVals = math.range(-10, 10, 0.5).toArray();
  const yVals = xVals.map(x => f.evaluate({x}));
  const dy = xVals.map(x => fd.evaluate({x}));

  Plotly.newPlot('plot', [
    {x: xVals, y: yVals, name:'f(x)', mode:'lines'},
    {x: xVals, y: dy, name:"f'(x)", mode:'lines'}
  ], {title: 'Función y su derivada'});
}
</script>
</body>
</html>
